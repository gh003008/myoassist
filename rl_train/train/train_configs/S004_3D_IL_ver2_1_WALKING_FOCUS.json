{
    "total_timesteps": 3e7,
    "evaluate_param_list":[
        {
            "num_timesteps": 200,
            "min_target_velocity": 0.8,
            "max_target_velocity": 0.8,
            "target_velocity_period": 2,
            "velocity_mode": "UNIFORM",
            "cam_type": "follow",
            "cam_distance": 2.5,
            "visualize_activation": true
        }
    ],
    "logger_params": {
        "logging_frequency": 8
    },
    "env_params": {
        "env_id": "myoAssistLegImitationExo-v2_1",
        "num_envs": 8,
        "seed": 1234,
        "safe_height": 0.7,
        "out_of_trajectory_threshold": 0.6,
        "flag_random_ref_index": false,
        "control_framerate": 30,
        "physics_sim_framerate": 1200,
        
        "min_target_velocity": 0.8,
        "max_target_velocity": 0.8,
        "min_target_velocity_period": 2,
        "max_target_velocity_period": 10,

        "enable_lumbar_joint": false,
        "lumbar_joint_fixed_angle": -0.13,
        "lumbar_joint_damping_value": 0.05,
        
        "model_path": "models/26muscle_3D/myoLeg26_BASELINE.xml",
        "reference_data_path": "rl_train/reference_data/S004_trial01_08mps_3D_HDF5_v7.npz",

        "observation_joint_pos_keys": [
            "ankle_angle_l", "ankle_angle_r",
            "hip_flexion_l", "hip_flexion_r",
            "hip_adduction_l", "hip_adduction_r",
            "hip_rotation_l", "hip_rotation_r",
            "knee_angle_l", "knee_angle_r",
            "pelvis_list", "pelvis_tilt", "pelvis_rotation",
            "pelvis_tx", "pelvis_ty", "pelvis_tz"
        ],
        "observation_joint_vel_keys": [
            "ankle_angle_l", "ankle_angle_r",
            "hip_flexion_l", "hip_flexion_r",
            "hip_adduction_l", "hip_adduction_r",
            "hip_rotation_l", "hip_rotation_r",
            "knee_angle_l", "knee_angle_r",
            "pelvis_list", "pelvis_tilt", "pelvis_rotation",
            "pelvis_tx", "pelvis_ty", "pelvis_tz"
        ],
        "reference_data_keys": [
            "ankle_angle_l", "ankle_angle_r",
            "hip_flexion_l", "hip_flexion_r",
            "hip_adduction_l", "hip_adduction_r",
            "hip_rotation_l", "hip_rotation_r",
            "knee_angle_l", "knee_angle_r",
            "pelvis_list", "pelvis_tilt", "pelvis_rotation",
            "pelvis_tx", "pelvis_ty", "pelvis_tz"
        ],
        "observation_sensor_keys": [
            "r_foot", "l_foot", "r_toes", "l_toes"
        ],

        "joint_limit_sensor_keys": [
            "r_knee_sensor",
            "l_knee_sensor",
            "r_hip_sensor",
            "l_hip_sensor",
            "r_ankle_sensor",
            "l_ankle_sensor",
            "r_mtp_sensor",
            "l_mtp_sensor"
        ],

        "terrain_type": "flat",
        
        "reward_keys_and_weights": {
            "_comment_strategy": "TREADMILL-AWARE: Reference is treadmill (pelvis_tx meaningless), but policy learns forward locomotion via forward_reward. Absolute position (qpos) ignored, velocity patterns (qvel) preserved.",
            
            "qpos_imitation_rewards": {
                "pelvis_tx": 0.0,
                "pelvis_ty": 2.0,
                "pelvis_tz": 1.8,
                "pelvis_list": 1.2,
                "pelvis_tilt": 1.2,
                "pelvis_rotation": 1.0,
                "hip_flexion_l": 2.0,
                "hip_flexion_r": 2.0,
                "hip_adduction_l": 1.2,
                "hip_adduction_r": 1.2,
                "hip_rotation_l": 0.8,
                "hip_rotation_r": 0.8,
                "knee_angle_l": 2.5,
                "knee_angle_r": 2.5,
                "ankle_angle_l": 1.0,
                "ankle_angle_r": 1.0
            },
            "qvel_imitation_rewards": {
                "pelvis_tx": 2.0,
                "pelvis_ty": 1.0,
                "pelvis_tz": 1.0,
                "pelvis_list": 0.4,
                "pelvis_tilt": 0.4,
                "pelvis_rotation": 0.4,
                "hip_flexion_l": 1.5,
                "hip_flexion_r": 1.5,
                "hip_adduction_l": 0.8,
                "hip_adduction_r": 0.8,
                "hip_rotation_l": 0.5,
                "hip_rotation_r": 0.5,
                "knee_angle_l": 1.5,
                "knee_angle_r": 1.5,
                "ankle_angle_l": 0.8,
                "ankle_angle_r": 0.8
            },
            "end_effector_imitation_reward": 0.0,
            "forward_reward": 1.0,
            "muscle_activation_penalty": 0.15,
            "muscle_activation_diff_penalty": 0.1,

            "footstep_delta_time": 0.0,
            "average_velocity_per_step": 0.0,
            "muscle_activation_penalty_per_step": 0.0,

            "joint_constraint_force_penalty": 0.0,

            "foot_force_penalty": 0.15,

            "_comment_balance": "Balance rewards as soft constraints (lower weights than walking)",
            "pelvis_list_penalty": 0.4,
            "pelvis_height_reward": 0.1,

            "_comment_smooth_motion": "DeepMimic-style velocity/acceleration constraints (keep original values as control variables)",
            "joint_velocity_constraint": 0.5,
            "joint_acceleration_penalty": 0.3,
            "phase_muscle_reward": 0.05
        },
        "custom_max_episode_steps": 1000,
        "prev_trained_policy_path": null,
        "_comment_max_rot": "Rotation termination threshold: cos(53Â°) = 0.6",
        "max_rot": 0.6
    },
    "ppo_params": {
        "learning_rate": 3e-05,
        "n_steps": 512,
        "batch_size": 2048,
        "n_epochs": 10,
        "gamma": 0.99,
        "gae_lambda": 0.95,
        "clip_range": 0.2,
        "clip_range_vf": 100,
        "ent_coef": 0.001,
        "vf_coef": 0.25,
        "max_grad_norm": 0.5,
        "use_sde": false,
        "sde_sample_freq": -1,
        "target_kl": 0.01,

        "device": "cuda"
    },
    "policy_params": {
        "custom_policy_params": {
            "net_arch": {
                        "human_actor": [64, 64],
                        "exo_actor": [8, 8],
                        "common_critic": [64, 64]
                    },
            "net_indexing_info": {
                "human_actor":
                {
                    "observation":
                        [
                            {
                                "type":"range",
                                "range":[0,8],
                                "comment":"8 qpos without lumbar_extension"
                            },
                            {
                                "type":"range",
                                "range":[8,17],
                                "comment":"9 qvel without lumbar_extension"
                            },
                            {
                                "type":"range",
                                "range":[17,28],
                                "comment":"11 left muscle activation"
                            },
                            {
                                "type":"range",
                                "range":[28,39],
                                "comment":"11 right muscle activation"
                            },
                            {
                                "type":"range",
                                "range":[39,43],
                                "comment":"4 foot force"
                            },
                            {
                                "type":"range",
                                "range":[43,44],
                                "comment":"target velocity"
                            }
                        ],
                    "action":
                        [
                            {
                                "type":"range_mapping",
                                "range_net":[0,11],
                                "range_action":[0,11],
                                "comment":"r 11 muscle activation without exo"
                            },
                            {
                                "type":"range_mapping",
                                "range_net":[11,22],
                                "range_action":[11,22],
                                "comment":"l 11 muscle activation without exo"
                            }
                        ]
                },
                "exo_actor": 
                {
                    "observation":
                        [
                            {
                                "type":"range",
                                "range":[0,2],
                                "comment":"2 ankle angle in 8 qpos without lumbar_extension"
                            },
                            {
                                "type":"range",
                                "range":[8,10],
                                "comment":"2 angkle angular in 9 qvel without lumbar_extension"
                            }
                        ],
                    "action":
                        [
                            {
                                "type":"range_mapping",
                                "range_net":[0,2],
                                "range_action":[22,24],
                                "comment":"2 for exo L, R"
                            },
                            {
                                "type":"constant",
                                "range_action":[22,24],
                                "default_value":1.0,
                                "comment":"override exo"
                            }
                        ]
                },
                "common_critic": 
                {
                    "observation":
                        [
                            {
                                "type":"range",
                                "range":[0,8],
                                "comment":"8 qpos without lumbar_extension"
                            },
                            {
                                "type":"range",
                                "range":[8,17],
                                "comment":"9 qvel without lumbar_extension"
                            },
                            {
                                "type":"range",
                                "range":[17,28],
                                "comment":"11 left muscle activation"
                            },
                            {
                                "type":"range",
                                "range":[28,39],
                                "comment":"11 right muscle activation"
                            },
                            {
                                "type":"range",
                                "range":[39,43],
                                "comment":"4 foot force"
                            },
                            {
                                "type":"range",
                                "range":[43,44],
                                "comment":"target velocity"
                            }
                        ]
                }
            },
            "log_std_init": 0.0
        }
    },
    "auto_reward_adjust_params":{
        "learning_rate": 0.0
    },
    "_comment_design": "251119_v2 - TREADMILL-AWARE WALKING: RSI enabled for diverse episode starts. pelvis_tx qpos=0.0 (treadmill reference has no absolute position meaning), but pelvis_tx qvel=2.0 (velocity pattern preserved). forward_reward=1.0 drives actual locomotion. Balance (pelvis_ty/tz qpos increased, list_penalty=0.4) prevents falling. DeepMimic constraints tuned conservatively (vel=0.3, acc=0.2, phase=0.05) to avoid over-constraining early learning. foot_force_penalty reduced to 0.15 to allow natural ground contact."
}

# MyoAssist í•œê¸€ ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ

## ğŸ¯ ëª¨ë°©í•™ìŠµì´ë€?

ì´ í”„ë ˆì„ì›Œí¬ëŠ” **Reward Shaping ê¸°ë°˜ Imitation Learning (ëª¨ë°©í•™ìŠµ)** ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

### ë°©ì‹ ë¹„êµ
- âŒ **GAIL/AIRL** (Adversarial ë°©ì‹) - ì•„ë‹˜
- âŒ **Behavioral Cloning** (Supervised Learning) - ì•„ë‹˜  
- âœ… **Reference Motion Tracking** (ì´ í”„ë ˆì„ì›Œí¬ ë°©ì‹)
  - Reference trajectoryë¥¼ reward functionì— ì§ì ‘ í¬í•¨
  - PPOë¡œ í•™ìŠµí•˜ë˜ imitation reward ì¶”ê°€
  - DeepMimic (SIGGRAPH 2018) ìŠ¤íƒ€ì¼
  - ê³„ì‚°ì´ ê°€ë³ê³  êµ¬í˜„ì´ ë‹¨ìˆœ

### ì‘ë™ ì›ë¦¬
```python
# ê´€ì ˆ ìœ„ì¹˜ì™€ ì†ë„ë¥¼ reference motionê³¼ ë¹„êµ
q_reward = exp(-8 * (qpos - qpos_ref)Â²)   # ìœ„ì¹˜ ì°¨ì´
dq_reward = exp(-8 * (qvel - qvel_ref)Â²)  # ì†ë„ ì°¨ì´
total_reward = q_reward + dq_reward + forward_reward + penalties
```

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1ï¸âƒ£ í™˜ê²½ ì„¸íŒ… (ì²˜ìŒ í•œ ë²ˆë§Œ)

```powershell
# Conda í™˜ê²½ ìƒì„± ë° í™œì„±í™”
conda create -n myoassist python=3.11 -y
conda activate myoassist

# MyoAssist ì„¤ì¹˜
pip install -e .

# ì„¤ì¹˜ í™•ì¸
python test_setup.py
```

### 2ï¸âƒ£ ëª¨ë°©í•™ìŠµ í›ˆë ¨

#### ğŸ¬ ë°©ë²• 1: PowerShell ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš© (ê°€ì¥ ì‰¬ì›€)
```powershell
# ê¸°ë³¸ í›ˆë ¨ (ë¶€ë¶„ ê´€ì¸¡)
.\run_imitation_training.ps1

# ë˜ëŠ” ë‹¤ë¥¸ ì„¤ì • ì„ íƒ
.\run_imitation_training.ps1 full_obs        # ì „ì²´ ê´€ì¸¡
.\run_imitation_training.ps1 speed_control   # ì†ë„ ì œì–´
.\run_imitation_training.ps1 exo_off         # ì™¸ê³¨ê²© OFF
```

#### ğŸ’» ë°©ë²• 2: ì§ì ‘ ëª…ë ¹ì–´
```powershell
conda activate myoassist
python rl_train/run_train.py --config_file_path rl_train/train/train_configs/imitation_tutorial_22_separated_net_partial_obs.json
```

#### âš¡ ë°©ë²• 3: ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ (5ë¶„ ì•ˆì— í™•ì¸)
```powershell
conda activate myoassist
python rl_train/run_train.py --config_file_path rl_train/train/train_configs/test.json --flag_rendering
```

### 3ï¸âƒ£ ê²°ê³¼ í‰ê°€

#### ğŸ¬ ë°©ë²• 1: PowerShell ìŠ¤í¬ë¦½íŠ¸
```powershell
# Pretrained ëª¨ë¸ í‰ê°€
.\run_imitation_eval.ps1

# ë˜ëŠ” íŠ¹ì • ì„¸ì…˜ í‰ê°€
.\run_imitation_eval.ps1 rl_train/results/train_session_20250112-123456
```

#### ğŸ’» ë°©ë²• 2: ì§ì ‘ ëª…ë ¹ì–´
```powershell
conda activate myoassist
python rl_train/run_policy_eval.py docs/assets/tutorial_rl_models/train_session_20250728-161129_tutorial_partial_obs
```

### 4ï¸âƒ£ ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜ ë³´ê¸°

```powershell
conda activate myoassist

# Pretrained ëª¨ë¸ë¡œ ì‹¤ì‹œê°„ ì‹¤í–‰
python rl_train/run_train.py `
  --config_file_path docs/assets/tutorial_rl_models/train_session_20250728-161129_tutorial_partial_obs/session_config.json `
  --config.env_params.prev_trained_policy_path docs/assets/tutorial_rl_models/train_session_20250728-161129_tutorial_partial_obs/trained_models/model_19939328 `
  --flag_realtime_evaluate
```

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
myoassist/
â”œâ”€â”€ rl_train/                                    # ê°•í™”í•™ìŠµ/ëª¨ë°©í•™ìŠµ ë©”ì¸ í´ë”
â”‚   â”œâ”€â”€ run_train.py                            # í›ˆë ¨ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ run_policy_eval.py                      # í‰ê°€ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ envs/                                   
â”‚   â”‚   â”œâ”€â”€ myoassist_leg_imitation.py         # ëª¨ë°©í•™ìŠµ í™˜ê²½ (í•µì‹¬!)
â”‚   â”‚   â””â”€â”€ myoassist_leg_imitation_exo.py     # ì™¸ê³¨ê²© í¬í•¨ ëª¨ë°©í•™ìŠµ
â”‚   â”œâ”€â”€ reference_data/                         # ëª¨ë°©í•  reference motion
â”‚   â”‚   â”œâ”€â”€ short_reference_gait.npz           # ì§§ì€ ë³´í–‰ ë°ì´í„°
â”‚   â”‚   â””â”€â”€ segmented.npz                      # ì„¸ê·¸ë¨¼íŠ¸ ë³´í–‰ ë°ì´í„°
â”‚   â”œâ”€â”€ train/
â”‚   â”‚   â””â”€â”€ train_configs/                     # í›ˆë ¨ ì„¤ì • íŒŒì¼ë“¤
â”‚   â”‚       â”œâ”€â”€ imitation_tutorial_22_separated_net_partial_obs.json
â”‚   â”‚       â”œâ”€â”€ imitation_tutorial_22_separated_net_full_obs.json
â”‚   â”‚       â”œâ”€â”€ imitation_tutorial_22_separated_net_speed_control.json
â”‚   â”‚       â””â”€â”€ test.json                      # ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ìš©
â”‚   â””â”€â”€ results/                               # í›ˆë ¨ ê²°ê³¼ ì €ì¥ í´ë”
â”‚       â””â”€â”€ train_session_[ë‚ ì§œ-ì‹œê°„]/
â”‚           â”œâ”€â”€ session_config.json
â”‚           â”œâ”€â”€ train_log.json
â”‚           â”œâ”€â”€ trained_models/                # ì €ì¥ëœ ëª¨ë¸ë“¤
â”‚           â””â”€â”€ analyze_results_*/             # í‰ê°€ ê²°ê³¼ (plots, videos)
â”œâ”€â”€ models/                                     # MuJoCo ëª¨ë¸ íŒŒì¼ë“¤
â”‚   â”œâ”€â”€ 22muscle_2D/                           # 2D 22ê·¼ìœ¡ ëª¨ë¸
â”‚   â”œâ”€â”€ 26muscle_3D/                           # 3D 26ê·¼ìœ¡ ëª¨ë¸
â”‚   â””â”€â”€ 80muscle/                              # 80ê·¼ìœ¡ ëª¨ë¸
â”œâ”€â”€ docs/tutorial/                              # íŠœí† ë¦¬ì–¼ ë…¸íŠ¸ë¶
â”‚   â”œâ”€â”€ rl_imitation_tutorial.ipynb            # ëª¨ë°©í•™ìŠµ íŠœí† ë¦¬ì–¼ â­
â”‚   â””â”€â”€ rl_terrain_tutorial.ipynb              # ì§€í˜• ì ì‘ íŠœí† ë¦¬ì–¼
â”œâ”€â”€ setup_myoassist_env.ps1                     # í™˜ê²½ ì„¸íŒ… ìŠ¤í¬ë¦½íŠ¸ (ìƒˆë¡œ ìƒì„±!)
â”œâ”€â”€ run_imitation_training.ps1                  # í›ˆë ¨ ìŠ¤í¬ë¦½íŠ¸ (ìƒˆë¡œ ìƒì„±!)
â”œâ”€â”€ run_imitation_eval.ps1                      # í‰ê°€ ìŠ¤í¬ë¦½íŠ¸ (ìƒˆë¡œ ìƒì„±!)
â””â”€â”€ quick_commands.md                           # ë¹ ë¥¸ ëª…ë ¹ì–´ ëª¨ìŒ (ìƒˆë¡œ ìƒì„±!)
```

---

## âš™ï¸ Config íŒŒì¼ ìˆ˜ì •

### PC ì„±ëŠ¥ì— ë§ê²Œ ì¡°ì •

```powershell
# í™˜ê²½ ìˆ˜ë¥¼ 32 â†’ 16ìœ¼ë¡œ ì¤„ì´ê³ , n_stepsë¥¼ 512 â†’ 1024ë¡œ ì¦ê°€
python rl_train/run_train.py `
  --config_file_path rl_train/train/train_configs/imitation_tutorial_22_separated_net_partial_obs.json `
  --config.env_params.num_envs 16 `
  --config.ppo_params.n_steps 1024
```

### í›ˆë ¨ ì‹œê°„ ë‹¨ì¶•

```powershell
# 3ì²œë§Œ ìŠ¤í… â†’ 5ë°±ë§Œ ìŠ¤í… (ë¹ ë¥¸ í…ŒìŠ¤íŠ¸)
python rl_train/run_train.py `
  --config_file_path rl_train/train/train_configs/imitation_tutorial_22_separated_net_partial_obs.json `
  --config.total_timesteps 5000000
```

### GPU ì‚¬ìš© (ìˆëŠ” ê²½ìš°)

JSON config íŒŒì¼ì—ì„œ:
```json
"ppo_params": {
    "device": "cuda"  // "cpu" â†’ "cuda"ë¡œ ë³€ê²½
}
```

---

## ğŸ” í•µì‹¬ íŒŒì¼ ì„¤ëª…

### 1. ëª¨ë°©í•™ìŠµ í™˜ê²½ (`myoassist_leg_imitation.py`)

```python
class MyoAssistLegImitation(MyoAssistLegBase):
    def _calculate_imitation_rewards(self, obs_dict):
        # Reference motionê³¼ í˜„ì¬ ìƒíƒœ ë¹„êµ
        q_diff = sim.qpos - reference_data["qpos"][index]
        dq_diff = sim.qvel - reference_data["qvel"][index]
        
        # Exponential reward ê³„ì‚°
        q_reward = exp(-8 * q_diffÂ²)
        dq_reward = exp(-8 * dq_diffÂ²)
        
        return q_reward + dq_reward
    
    def imitation_step(self, is_x_follow, specific_index=None):
        # Reference motionì„ ì§ì ‘ ë”°ë¼ê°€ëŠ” í•¨ìˆ˜ (í…ŒìŠ¤íŠ¸ìš©)
        # ê´€ì ˆì„ reference ê°’ìœ¼ë¡œ ì§ì ‘ ì„¤ì •
```

### 2. Config íŒŒì¼ êµ¬ì¡°

```json
{
    "total_timesteps": 30000000,
    "env_params": {
        "env_id": "myoAssistLegImitationExo-v0",
        "num_envs": 32,
        "reference_data_path": "rl_train/reference_data/short_reference_gait.npz",
        "reference_data_keys": [
            "ankle_angle_l", "ankle_angle_r",
            "hip_flexion_l", "hip_flexion_r",
            "knee_angle_l", "knee_angle_r",
            "pelvis_tilt", "pelvis_tx", "pelvis_ty"
        ],
        "reward_keys_and_weights": {
            "qpos_imitation_rewards": {
                "knee_angle_l": 1.0,
                "knee_angle_r": 1.0,
                // ... ê´€ì ˆë³„ ê°€ì¤‘ì¹˜
            },
            "qvel_imitation_rewards": { /* ì†ë„ ë³´ìƒ */ },
            "forward_reward": 1.0,
            "muscle_activation_penalty": 0.1
        }
    },
    "ppo_params": {
        "learning_rate": 0.0001,
        "n_steps": 512,
        "batch_size": 8192,
        "n_epochs": 30
    }
}
```

---

## ğŸ“Š ê²°ê³¼ ë¶„ì„

### í›ˆë ¨ ë¡œê·¸ í™•ì¸

```powershell
# ì‹¤ì‹œê°„ ë¡œê·¸ ë³´ê¸° (í›ˆë ¨ ì¤‘)
Get-Content rl_train\results\train_session_*\train_log.json -Wait

# ìµœê·¼ í›ˆë ¨ ê²°ê³¼ í´ë” ì—´ê¸°
explorer (Get-ChildItem rl_train\results | Sort-Object LastWriteTime -Descending | Select-Object -First 1).FullName
```

### í‰ê°€ ê²°ê³¼ ìœ„ì¹˜

```
rl_train/results/train_session_[ë‚ ì§œ-ì‹œê°„]/analyze_results_[ìŠ¤í…ìˆ˜]_[í‰ê°€ë²ˆí˜¸]/
â”œâ”€â”€ plots/
â”‚   â”œâ”€â”€ joint_angles.png              # ê´€ì ˆ ê°ë„ ë¹„êµ
â”‚   â”œâ”€â”€ velocities.png                # ì†ë„ ë¹„êµ
â”‚   â”œâ”€â”€ muscle_activations.png        # ê·¼ìœ¡ í™œì„±í™”
â”‚   â””â”€â”€ rewards.png                   # ë³´ìƒ ê·¸ë˜í”„
â””â”€â”€ videos/
    â””â”€â”€ simulation.mp4                # ì‹œë®¬ë ˆì´ì…˜ ì˜ìƒ
```

---

## ğŸ› ï¸ ë¬¸ì œ í•´ê²°

### ìì£¼ ë°œìƒí•˜ëŠ” ì—ëŸ¬

#### 1. `ModuleNotFoundError: No module named 'flatten_dict'`
```powershell
# ëŒ€ë¶€ë¶„ ë‹¤ì‹œ ì‹¤í–‰í•˜ë©´ í•´ê²°ë¨
# ë˜ëŠ” ì§ì ‘ ì„¤ì¹˜
pip install flatten_dict
```

#### 2. `Conda í™˜ê²½ì´ í™œì„±í™”ë˜ì§€ ì•ŠìŒ`
```powershell
# PowerShell ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì •ì±… ì„¤ì •
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# ìˆ˜ë™ìœ¼ë¡œ í™˜ê²½ í™œì„±í™”
conda activate myoassist
```

#### 3. `MuJoCo ê´€ë ¨ ì—ëŸ¬`
```powershell
pip install mujoco==3.3.3 --force-reinstall
```

#### 4. `ë©”ëª¨ë¦¬ ë¶€ì¡± (Out of Memory)`
```powershell
# num_envsë¥¼ ì¤„ì´ê¸° (32 â†’ 8)
python rl_train/run_train.py `
  --config_file_path rl_train/train/train_configs/imitation_tutorial_22_separated_net_partial_obs.json `
  --config.env_params.num_envs 8 `
  --config.ppo_params.n_steps 2048
```

#### 5. `í›ˆë ¨ì´ ë„ˆë¬´ ëŠë¦¼`
```powershell
# í™˜ê²½ ìˆ˜ ì¤„ì´ê³  ë””ë°”ì´ìŠ¤ í™•ì¸
python -c "import torch; print(f'CUDA available: {torch.cuda.is_available()}')"

# GPU ì‚¬ìš© (ê°€ëŠ¥í•˜ë©´)
# config.jsonì—ì„œ "device": "cuda"ë¡œ ë³€ê²½
```

---

## ğŸ’¡ íŒê³¼ íŠ¸ë¦­

### 1. í›ˆë ¨ ì§„í–‰ ìƒí™© ì‹œê°í™”
```powershell
# ë Œë”ë§ ì¼œê³  í›ˆë ¨ (ëŠë¦¬ì§€ë§Œ ì§„í–‰ ìƒí™© í™•ì¸ ê°€ëŠ¥)
python rl_train/run_train.py `
  --config_file_path rl_train/train/train_configs/test.json `
  --flag_rendering
```

### 2. ì—¬ëŸ¬ ì„¤ì • ë¹„êµ
```powershell
# Partial observation í›ˆë ¨
.\run_imitation_training.ps1 partial_obs

# Full observation í›ˆë ¨
.\run_imitation_training.ps1 full_obs

# ê²°ê³¼ ë¹„êµ
.\run_imitation_eval.ps1 rl_train/results/train_session_1
.\run_imitation_eval.ps1 rl_train/results/train_session_2
```

### 3. Transfer Learning (ì „ì´í•™ìŠµ)
```powershell
# ì´ì „ ëª¨ë¸ì—ì„œ ê³„ì† í•™ìŠµ
python rl_train/run_train.py `
  --config_file_path rl_train/train/train_configs/imitation_tutorial_22_separated_net_partial_obs.json `
  --config.env_params.prev_trained_policy_path rl_train/results/train_session_YYYYMMDD-HHMMSS/trained_models/model_10000000
```

### 4. Jupyter Notebookìœ¼ë¡œ ì‹¤í—˜
```powershell
conda activate myoassist
jupyter notebook docs/tutorial/rl_imitation_tutorial.ipynb
```

---

## ğŸ“š ë” ì•Œì•„ë³´ê¸°

### ê³µì‹ ë¬¸ì„œ
- **ë©”ì¸ í˜ì´ì§€**: https://myoassist.neumove.org/
- **RL ê°€ì´ë“œ**: https://myoassist.neumove.org/reinforcement-learning/
- **Config ì„¤ëª…**: https://myoassist.neumove.org/reinforcement-learning/02_configuration
- **GitHub**: https://github.com/neumovelab/myoassist

### ê´€ë ¨ ë…¼ë¬¸
- **DeepMimic** (SIGGRAPH 2018): Motion Imitationì˜ ê¸°ë°˜
- **MyoSuite** (NeurIPS 2022): ì´ í”„ë ˆì„ì›Œí¬ì˜ ê¸°ë°˜

---

## ğŸ“ í•™ìŠµ ìˆœì„œ ì¶”ì²œ

1. âœ… **í™˜ê²½ ì„¸íŒ…** - `setup_myoassist_env.ps1` ë˜ëŠ” ìˆ˜ë™ ì„¤ì¹˜
2. âœ… **ë¹ ë¥¸ í…ŒìŠ¤íŠ¸** - `test.json`ìœ¼ë¡œ 5ë¶„ í›ˆë ¨
3. âœ… **Pretrained ëª¨ë¸ ì‹¤í–‰** - ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ë¨¼ì € ë³´ê¸°
4. âœ… **íŠœí† ë¦¬ì–¼ ë…¸íŠ¸ë¶** - `rl_imitation_tutorial.ipynb` ë”°ë¼í•˜ê¸°
5. âœ… **ë³¸ê²© í›ˆë ¨** - `partial_obs.json`ìœ¼ë¡œ í’€ í›ˆë ¨
6. âœ… **Config ìˆ˜ì •** - ë³´ìƒ í•¨ìˆ˜ë‚˜ ë„¤íŠ¸ì›Œí¬ êµ¬ì¡° ì‹¤í—˜
7. âœ… **ë…¼ë¬¸ ì½ê¸°** - DeepMimic, MyoSuite ë…¼ë¬¸

---

## ğŸ“ ë„ì›€ë§

- **Issues**: https://github.com/neumovelab/myoassist/issues
- **Survey**: [í”¼ë“œë°± ë‚¨ê¸°ê¸°](https://docs.google.com/forms/d/e/1FAIpQLSdyd8T8Vqt4vtIVDGpYT7h2VOHeG4zd06EURFyuUW0XA8RKTA/viewform)

---

**Happy Imitation Learning! ğŸš€**
